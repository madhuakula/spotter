- name: insecure sample 1 should fail
  pass: false
  input: |
    apiVersion: extensions/v1beta1
    kind: Deployment
    metadata: 
      labels: 
        app: helm
        name: tiller
      name: tiller-deploy
    spec: 
      containers: 
        - 
          image: tiller-image
          name: tiller-v1
      template: 
        metadata: 
          labels: 
            app: helm
            name: tiller
        spec: 
          containers: 
            - 
              args: 
                - "--listen=10.7.2.8:44134"
              image: tiller-image
              name: tiller-v2
              ports: 
                - 
                  containerPort: 44134
                  name: tiller
                  protocol: TCP
                - 
                  containerPort: 44135
                  name: http
                  protocol: TCP
          serviceAccountName: tiller

- name: secure sample 1 should pass
  pass: true
  input: |
    apiVersion: v1
    kind: Pod
    metadata:
      name: security-context-demo
    spec:
      securityContext:
        runAsUser: 1000
        runAsGroup: 3000
        fsGroup: 2000
      volumes:
        - name: sec-ctx-vol
      containers:
        - name: sec-ctx-demo
          image: busybox
          command: [ "sh", "-c", "sleep 1h" ]
          volumeMounts:
            - name: sec-ctx-vol
              mountPath: /data/demo
          securityContext:
            allowPrivilegeEscalation: false